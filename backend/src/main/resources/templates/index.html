<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart List</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        body {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .header-content {
            display: flex;
            width: 100%;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            cursor: pointer;
            color: #2c3e50;
            font-size: 24px;
            text-decoration: none;
        }

        .logo:hover {
            color: #3498db;
        }

        .search-bar {
            display: flex;
            align-items: center;
            margin: 0 20px;
            flex-grow: 1;
            max-width: 500px;
        }

        .search-bar input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
        }

        .search-bar button {
            padding: 10px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }

        .search-bar button:hover {
            background-color: #2980b9;
        }

        .add-note-btn {
            padding: 10px 15px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .add-note-btn:hover {
            background-color: #27ae60;
        }

        .note-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 10px;
        }

        .note-actions button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 5px;
        }

        .edit-btn {
            color: #3498db;
        }

        .delete-btn {
            color: #e74c3c;
        }

        .note-list {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .note-list ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .note-item {
            background: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .note-meta {
            margin-top: 10px;
            color: #7f8c8d;
            font-size: 14px;
        }

        .no-notes {
            text-align: center;
            color: #7f8c8d;
            margin-top: 50px;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal {
            background: white;
            padding: 25px;
            border-radius: 8px;
            width: 100%;
            max-width: 500px;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .counter {
            display: flex;
            align-items: center;
        }

        .counter button {
            padding: 5px 10px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .counter span {
            margin: 0 10px;
            min-width: 30px;
            text-align: center;
        }

        .submit-btn {
            padding: 10px 15px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }

        .submit-btn:hover {
            background: #27ae60;
        }
    </style>
</head>
<body>
<div class="header">
    <div class="header-content">
        <a href="/" class="logo">Smart List</a>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Поиск заметок...">
            <button onclick="searchNotes()">Поиск</button>
        </div>
        <a href="#" class="add-note-btn" onclick="openModal(); return false;">Добавить заметку</a>
    </div>
</div>

<div class="note-list" id="noteList">
    <!-- Заметки будут загружаться здесь -->
</div>

<!-- Окно добавления -->
<div class="modal-overlay" id="addModal">
    <div class="modal">
        <button class="close-btn" onclick="closeModal('addModal')">×</button>
        <h2>Добавить заметку</h2>
        <form id="addForm" onsubmit="handleAddSubmit(event)">
            <div class="form-group">
                <label for="addTitle">Заголовок</label>
                <input type="text" id="addTitle" required>
            </div>
            <div class="form-group">
                <label for="addDescription">Описание</label>
                <textarea id="addDescription"></textarea>
            </div>
            <div class="form-group">
                <label>Количество штук</label>
                <div class="counter">
                    <button type="button" onclick="changeCount('addCount', -1)">-</button>
                    <span id="addCount">0</span>
                    <button type="button" onclick="changeCount('addCount', 1)">+</button>
                </div>
            </div>
            <button type="submit" class="submit-btn">Добавить</button>
        </form>
    </div>
</div>

<!-- Окно редактирования -->
<div class="modal-overlay" id="editModal">
    <div class="modal">
        <button class="close-btn" onclick="closeModal('editModal')">×</button>
        <h2>Редактировать заметку</h2>
        <form id="editForm" onsubmit="handleEditSubmit(event)">
            <div class="form-group">
                <label for="editTitle">Заголовок</label>
                <input type="text" id="editTitle" required>
            </div>
            <div class="form-group">
                <label for="editDescription">Описание</label>
                <textarea id="editDescription"></textarea>
            </div>
            <div class="form-group">
                <label>Количество штук</label>
                <div class="counter">
                    <button type="button" onclick="changeCount('editCount', -1)">-</button>
                    <span id="editCount">0</span>
                    <button type="button" onclick="changeCount('editCount', 1)">+</button>
                </div>
            </div>
            <button type="submit" class="submit-btn">Сохранить</button>
        </form>
    </div>
</div>

<script>
    // JavaScript (замените весь ваш текущий скрипт этим кодом)
let currentEditingId = null;

// Инициализация
document.addEventListener('DOMContentLoaded', function() {
    loadNotes();

    // Обработчики форм
    document.getElementById('addForm').addEventListener('submit', function(e) {
        e.preventDefault();
        saveNote(false);
    });

    document.getElementById('editForm').addEventListener('submit', function(e) {
        e.preventDefault();
        saveNote(true);
    });
});

// Загрузка заметок
function loadNotes() {
    fetch('/api/notes')
        .then(response => response.json())
        .then(notes => {
            const noteList = document.getElementById('noteList');
            noteList.innerHTML = '';

            if (!notes || notes.length === 0) {
                noteList.innerHTML = '<p class="no-notes">Заметок не найдено</p>';
                return;
            }

            const ul = document.createElement('ul');
            notes.forEach(note => {
                const li = document.createElement('li');
                li.className = 'note-item';
                li.innerHTML = `
                    <h3>${note.title || 'Без названия'}</h3>
                    <p>${note.description || ''}</p>
                    <div class="note-meta">
                        <span>Количество: ${note.count || 0}</span>
                        <div class="note-actions">
                            <button class="edit-btn" onclick="editNote('${note.id}')">✏️</button>
                            <button class="delete-btn" onclick="deleteNote('${note.id}')">🗑️</button>
                        </div>
                    </div>
                `;
                ul.appendChild(li);
            });
            noteList.appendChild(ul);
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('noteList').innerHTML = '<p class="no-notes">Ошибка загрузки</p>';
        });
}

// Удаление заметки
function deleteNote(noteId) {
    if (!confirm('Вы уверены, что хотите удалить эту заметку?')) return;

    fetch(`/api/notes/${noteId}`, {
        method: 'DELETE',
        headers: { 'Content-Type': 'application/json' }
    })
    .then(response => {
        if (!response.ok) throw new Error('Ошибка удаления');
        loadNotes();
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Ошибка при удалении: ' + error.message);
    });
}

// Редактирование заметки
function editNote(noteId) {
    fetch(`/api/notes/${noteId}`)
        .then(response => response.json())
        .then(note => {
            currentEditingId = note.id;
            document.getElementById('editTitle').value = note.title;
            document.getElementById('editDescription').value = note.description || '';
            document.getElementById('editCount').textContent = note.count || 0;
            openModal('editModal');
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Не удалось загрузить заметку для редактирования');
        });
}

// Сохранение заметки
function saveNote(isEdit) {
    const prefix = isEdit ? 'edit' : 'add';
    const noteData = {
        title: document.getElementById(`${prefix}Title`).value,
        description: document.getElementById(`${prefix}Description`).value,
        count: parseInt(document.getElementById(`${prefix}Count`).textContent)
    };

    const url = isEdit ? `/api/notes/${currentEditingId}` : '/api/notes';
    const method = isEdit ? 'PUT' : 'POST';

    fetch(url, {
        method: method,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(noteData)
    })
    .then(response => {
        if (!response.ok) throw new Error('Ошибка сохранения');
        return response.json();
    })
    .then(() => {
        closeModal(isEdit ? 'editModal' : 'addModal');
        resetForm(isEdit ? 'editForm' : 'addForm');
        loadNotes();
        alert(isEdit ? 'Заметка обновлена!' : 'Заметка добавлена!');
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Ошибка: ' + error.message);
    });
}

// Поиск заметок
function searchNotes() {
    const query = document.getElementById('searchInput').value.trim();
    if (!query) {
        loadNotes();
        return;
    }

    fetch(`/api/notes/search?name=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(notes => {
            const noteList = document.getElementById('noteList');
            noteList.innerHTML = '';

            if (!notes || notes.length === 0) {
                noteList.innerHTML = '<p class="no-notes">Ничего не найдено</p>';
                return;
            }

            const ul = document.createElement('ul');
            notes.forEach(note => {
                const li = document.createElement('li');
                li.className = 'note-item';
                li.innerHTML = `
                    <h3>${note.title}</h3>
                    <p>${note.description || ''}</p>
                    <div class="note-meta">
                        <span>Количество: ${note.count || 0}</span>
                        <div class="note-actions">
                            <button class="edit-btn" onclick="editNote('${note.id}')">✏️</button>
                            <button class="delete-btn" onclick="deleteNote('${note.id}')">🗑️</button>
                        </div>
                    </div>
                `;
                ul.appendChild(li);
            });
            noteList.appendChild(ul);
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('noteList').innerHTML = '<p class="no-notes">Ошибка поиска</p>';
        });
}

// Вспомогательные функции
function openModal(modalId) {
    document.getElementById(modalId).style.display = 'flex';
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

function changeCount(elementId, delta) {
    const element = document.getElementById(elementId);
    let count = parseInt(element.textContent);
    count = Math.max(0, count + delta);
    element.textContent = count;
}

function resetForm(formId) {
    const prefix = formId === 'editForm' ? 'edit' : 'add';
    document.getElementById(`${prefix}Title`).value = '';
    document.getElementById(`${prefix}Description`).value = '';
    document.getElementById(`${prefix}Count`).textContent = '0';
}

// Обработка нажатия Enter в поле поиска
document.getElementById('searchInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        searchNotes();
    }
});

// Обработчик кнопки добавления заметки
document.querySelector('.add-note-btn').addEventListener('click', function(e) {
    e.preventDefault();
    openModal('addModal');
});

<!--    // Загрузка заметок при загрузке страницы-->
<!--    document.addEventListener('DOMContentLoaded', function() {-->
<!--        loadNotes();-->
<!--    });-->

<!--        function loadNotes() {-->
<!--            fetch('/api/notes')-->
<!--                .then(response => response.json())-->
<!--                .then(notes => {-->
<!--                    const noteList = document.getElementById('noteList');-->
<!--                    noteList.innerHTML = '';-->

<!--                    if (!notes || notes.length === 0) {-->
<!--                        noteList.innerHTML = '<p class="no-notes">Заметок не найдено</p>';-->
<!--                        return;-->
<!--                    }-->

<!--                    const ul = document.createElement('ul');-->
<!--                    notes.forEach(note => {-->
<!--                        const li = document.createElement('li');-->
<!--                        li.className = 'note-item';-->
<!--                        li.innerHTML = `-->
<!--                            <h3>${note.title || 'Без названия'}</h3>-->
<!--                            <p>${note.description || ''}</p>-->
<!--                            <div class="note-meta">-->
<!--                                <span>Количество: ${note.count || 0}</span>-->
<!--                                <div class="note-actions">-->
<!--                                    <button class="edit-btn" onclick="editNote('${note.id}')">✏️</button>-->
<!--                                    <button class="delete-btn" onclick="deleteNote('${note.id}')">🗑️</button>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        `;-->
<!--                        ul.appendChild(li);-->
<!--                    });-->
<!--                    noteList.appendChild(ul);-->
<!--                })-->
<!--                .catch(error => {-->
<!--                    console.error('Error loading notes:', error);-->
<!--                    document.getElementById('noteList').innerHTML = '<p class="no-notes">Ошибка загрузки</p>';-->
<!--                });-->
<!--        }-->

<!--function deleteNote(noteId) {-->
<!--    if (!confirm('Вы уверены, что хотите удалить эту заметку?')) return;-->

<!--    fetch(`/api/notes/${noteId}`, {-->
<!--        method: 'DELETE',-->
<!--        headers: {-->
<!--            'Content-Type': 'application/json'-->
<!--        }-->
<!--    })-->
<!--    .then(response => {-->
<!--        if (!response.ok) {-->
<!--            return response.text().then(text => { throw new Error(text) });-->
<!--        }-->
<!--        loadNotes(); // Обновляем список после удаления-->
<!--    })-->
<!--    .catch(error => {-->
<!--        console.error('Delete error:', error);-->
<!--        alert('Ошибка при удалении: ' + error.message);-->
<!--    });-->
<!--}-->

<!--let currentEditingNote = null;-->

<!--function editNote(noteId) {-->
<!--    fetch(`/api/notes/${noteId}`)-->
<!--        .then(response => response.json())-->
<!--        .then(note => {-->
<!--            currentEditingNote = note;-->
<!--            document.getElementById('title').value = note.title;-->
<!--            document.getElementById('description').value = note.description || '';-->
<!--            document.getElementById('count').textContent = note.count || 0;-->
<!--            document.querySelector('.modal h2').textContent = 'Редактировать заметку';-->
<!--            openModal();-->
<!--        })-->
<!--        .catch(error => {-->
<!--            console.error('Error loading note:', error);-->
<!--            alert('Не удалось загрузить заметку для редактирования');-->
<!--        });-->
<!--}-->

<!--function submitNoteForm(event) {-->
<!--    event.preventDefault();-->

<!--    const noteData = {-->
<!--        title: document.getElementById('title').value,-->
<!--        description: document.getElementById('description').value,-->
<!--        count: parseInt(document.getElementById('count').textContent)-->
<!--    };-->

<!--    const url = currentEditingNote-->
<!--        ? `/api/notes/${currentEditingNote.id}`-->
<!--        : '/api/notes';-->

<!--    const method = currentEditingNote ? 'PUT' : 'POST';-->

<!--    fetch(url, {-->
<!--        method: method,-->
<!--        headers: {-->
<!--            'Content-Type': 'application/json',-->
<!--        },-->
<!--        body: JSON.stringify(noteData)-->
<!--    })-->
<!--    .then(response => {-->
<!--        if (!response.ok) {-->
<!--            return response.text().then(text => { throw new Error(text) });-->
<!--        }-->
<!--        closeModal();-->
<!--        resetNoteForm();-->
<!--        loadNotes();-->
<!--    })-->
<!--    .catch(error => {-->
<!--        console.error('Save error:', error);-->
<!--        alert('Ошибка сохранения: ' + error.message);-->
<!--    });-->
<!--}-->

<!--function resetNoteForm() {-->
<!--    currentEditingNote = null;-->
<!--    document.getElementById('title').value = '';-->
<!--    document.getElementById('description').value = '';-->
<!--    document.getElementById('count').textContent = '0';-->
<!--    document.querySelector('.modal h2').textContent = 'Добавить заметку';-->
<!--}-->

<!--    function searchNotes() {-->
<!--        const query = document.getElementById('searchInput').value.trim();-->
<!--        if (!query) {-->
<!--            loadNotes();-->
<!--            return;-->
<!--        }-->

<!--        fetch(`/api/notes/search?name=${encodeURIComponent(query)}`)-->
<!--            .then(response => response.json())-->
<!--            .then(notes => {-->
<!--                const noteList = document.getElementById('noteList');-->
<!--                if (notes.length === 0) {-->
<!--                    noteList.innerHTML = '<p class="no-notes">Ничего не найдено</p>';-->
<!--                    return;-->
<!--                }-->

<!--                let html = '<ul>';-->
<!--                notes.forEach(note => {-->
<!--                    html += `-->
<!--                        <li class="note-item">-->
<!--                            <h3>${note.title}</h3>-->
<!--                            <p>${note.description}</p>-->
<!--                            <div class="note-meta">-->
<!--                                <span>Количество: ${note.count}</span>-->
<!--                            </div>-->
<!--                        </li>-->
<!--                    `;-->
<!--                });-->
<!--                html += '</ul>';-->
<!--                noteList.innerHTML = html;-->
<!--            })-->
<!--            .catch(error => {-->
<!--                console.error('Error searching notes:', error);-->
<!--                document.getElementById('noteList').innerHTML = '<p class="no-notes">Ошибка поиска</p>';-->
<!--            });-->
<!--    }-->

<!--    function openModal() {-->
<!--        document.getElementById('modalOverlay').style.display = 'flex';-->
<!--    }-->

<!--    function closeModal() {-->
<!--        document.getElementById('modalOverlay').style.display = 'none';-->
<!--    }-->

<!--    function changeCount(delta) {-->
<!--        const countElement = document.getElementById('count');-->
<!--        let count = parseInt(countElement.textContent);-->
<!--        count += delta;-->
<!--        if (count < 0) count = 0;-->
<!--        countElement.textContent = count;-->
<!--    }-->

<!--        // Модифицируйте addNote для обработки редактирования-->
<!--        function addNote(event) {-->
<!--            event.preventDefault();-->

<!--            const noteData = {-->
<!--                title: document.getElementById('title').value,-->
<!--                description: document.getElementById('description').value,-->
<!--                count: parseInt(document.getElementById('count').textContent)-->
<!--            };-->

<!--            const url = currentEditId ? `/api/notes/${currentEditId}` : '/api/notes';-->
<!--            const method = currentEditId ? 'PUT' : 'POST';-->

<!--            fetch(url, {-->
<!--                method: method,-->
<!--                headers: { 'Content-Type': 'application/json' },-->
<!--                body: JSON.stringify(noteData)-->
<!--            })-->
<!--            .then(response => {-->
<!--                if (!response.ok) throw new Error('Ошибка сохранения');-->
<!--                closeModal();-->
<!--                loadNotes();-->
<!--                resetForm();-->
<!--            })-->
<!--            .catch(error => {-->
<!--                console.error('Save error:', error);-->
<!--                alert('Ошибка сохранения: ' + error.message);-->
<!--            });-->
<!--        }-->

<!--        function resetForm() {-->
<!--            currentEditId = null;-->
<!--            document.getElementById('title').value = '';-->
<!--            document.getElementById('description').value = '';-->
<!--            document.getElementById('count').textContent = '0';-->
<!--            document.querySelector('.modal h2').textContent = 'Добавить заметку';-->
<!--        }-->
<!--        let currentNoteId = null; // Для отслеживания режима (создание/редактирование)-->

<!--// Обработчик формы-->
<!--document.getElementById('noteForm').addEventListener('submit', function(e) {-->
<!--    e.preventDefault();-->
<!--    saveNote();-->
<!--});-->

<!--// Функция сохранения-->
<!--function saveNote() {-->
<!--    const noteData = {-->
<!--        title: document.getElementById('title').value,-->
<!--        description: document.getElementById('description').value,-->
<!--        count: parseInt(document.getElementById('count').textContent)-->
<!--    };-->

<!--    const url = currentNoteId ? `/api/notes/${currentNoteId}` : '/api/notes';-->
<!--    const method = currentNoteId ? 'PUT' : 'POST';-->

<!--    fetch(url, {-->
<!--        method: method,-->
<!--        headers: {-->
<!--            'Content-Type': 'application/json',-->
<!--        },-->
<!--        body: JSON.stringify(noteData)-->
<!--    })-->
<!--    .then(response => {-->
<!--        if (!response.ok) {-->
<!--            return response.json().then(err => { throw new Error(err.message || 'Ошибка сервера') });-->
<!--        }-->
<!--        return response.json();-->
<!--    })-->
<!--    .then(() => {-->
<!--        closeModal();-->
<!--        resetForm();-->
<!--        loadNotes();-->
<!--        alert(currentNoteId ? 'Заметка обновлена!' : 'Заметка создана!');-->
<!--    })-->
<!--    .catch(error => {-->
<!--        console.error('Save error:', error);-->
<!--        alert('Ошибка: ' + error.message);-->
<!--    });-->
<!--}-->

<!--// Функция редактирования-->
<!--function editNote(noteId) {-->
<!--    fetch(`/api/notes/${noteId}`)-->
<!--        .then(response => response.json())-->
<!--        .then(note => {-->
<!--            currentNoteId = note.id;-->
<!--            document.getElementById('title').value = note.title;-->
<!--            document.getElementById('description').value = note.description || '';-->
<!--            document.getElementById('count').textContent = note.count || 0;-->
<!--            document.querySelector('.modal h2').textContent = 'Редактировать заметку';-->
<!--            openModal();-->
<!--        });-->
<!--}-->

<!--// Сброс формы-->
<!--function resetForm() {-->
<!--    currentNoteId = null;-->
<!--    document.getElementById('title').value = '';-->
<!--    document.getElementById('description').value = '';-->
<!--    document.getElementById('count').textContent = '0';-->
<!--    document.querySelector('.modal h2').textContent = 'Добавить заметку';-->
<!--}-->

<!--    // Обработка нажатия Enter в поле поиска-->
<!--    document.getElementById('searchInput').addEventListener('keypress', function(e) {-->
<!--        if (e.key === 'Enter') {-->
<!--            searchNotes();-->
<!--        }-->
<!--    });-->
</script>
</body>
</html>
